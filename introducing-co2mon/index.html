<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><title>Announcing the co2mon crate</title><link href=/print.css media=print rel=stylesheet><link href=/poole.css rel=stylesheet><link href=/hyde.css rel=stylesheet><link href=https://blog.dend.ro/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://mapstodon.space/@lnicola rel=me><body><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://blog.dend.ro/><h1></h1></a></div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=/>Home</a><li class=sidebar-nav-item><a href=/content/talks/>Talks</a><li class=sidebar-nav-item><a href=/content/blogroll/>Blogroll</a><li class=sidebar-nav-item><a href=/content/acknowledgements/>Acknowledgements</a><li class=sidebar-nav-item><a href=https://www.buymeacoffee.com/lnicolaq>Buy me a ☕</a></ul></div></div><div class="content container"><div class=post><h1 class=post-title>Announcing the co2mon crate</h1><span class=post-date>2021-12-30</span><p>This is a couple of years too late, but I want to write a quick post announcing my first crate, <a href=https://crates.io/crates/co2mon><code>co2mon</code></a>. It's a small library for reading data from Holtek and similar CO₂ USB monitors. These are relatively popular, because the protocol <a href=https://hackaday.io/project/5301-reverse-engineering-a-low-cost-usb-co-monitor>was reverse-engineered</a> and it's easy to communicate with them.<h2 id=linux-prerequisites>Linux prerequisites</h2><p>If you're on Linux, you will need permissions to access the device node. The following <code>udev</code> rule will give permissions to every user on the system:<pre style=color:#c0c5ce;background-color:#2b303b><code><span>ACTION=="add|change", SUBSYSTEMS=="usb", ATTRS{idVendor}=="04d9", ATTRS{idProduct}=="a052", MODE:="0666"
</span></code></pre><p>See the crate documentation for details on how to install it. You can check the vendor and product id pair using the <code>lsusb</code> command.<p>If you get a linker error and you might need to install a <code>libusb-1.0-0-dev</code> or <code>libusb</code> package.<h2 id=getting-started>Getting started</h2><p>Add the <code>co2mon</code> dependency to your <code>Cargo.toml</code>, then copy-paste the following code and try to run it:<pre class=language-rust data-lang=rust style=color:#c0c5ce;background-color:#2b303b><code class=language-rust data-lang=rust><span style=color:#b48ead>use </span><span>co2mon::{Result, Sensor};
</span><span style=color:#b48ead>use </span><span>std::thread;
</span><span style=color:#b48ead>use </span><span>std::time::Duration;
</span><span>
</span><span style=color:#b48ead>fn </span><span style=color:#8fa1b3>main</span><span>() -> Result&lt;()> {
</span><span>    </span><span style=color:#b48ead>let</span><span> sensor = Sensor::open_default()?;
</span><span>    </span><span style=color:#b48ead>loop </span><span>{
</span><span>        </span><span style=color:#b48ead>match</span><span> sensor.</span><span style=color:#96b5b4>read</span><span>() {
</span><span>            Ok(reading) => println!("</span><span style=color:#d08770>{:.4}</span><span style=color:#a3be8c> °C, </span><span style=color:#d08770>{}</span><span style=color:#a3be8c> ppm CO₂</span><span>", reading.</span><span style=color:#96b5b4>temperature</span><span>(), reading.</span><span style=color:#96b5b4>co2</span><span>()),
</span><span>            Err(e) => eprintln!("</span><span style=color:#d08770>{}</span><span>", e),
</span><span>        }
</span><span>        thread::sleep(Duration::from_secs(</span><span style=color:#d08770>5</span><span>));
</span><span>    }
</span><span>}
</span></code></pre><p>The sensor sends various types of messages, in an arbitrary order. <code>Sensor::read</code> waits for a pair of temperature and CO₂ measurements and returns that. There's also a <code>Sensor::read_one</code> method, which returns a single message. This can be useful for versions of the sensor that also measure the relative humidity.<h2 id=device-support>Device support</h2><p>Tested using a TFA Dostmann <a href=https://www.tfa-dostmann.de/en/product/co2-monitor-airco2ntrol-mini-31-5006/>AIRCO2NTROL MINI</a>, but thanks to <a href=https://github.com/lnicola/co2mon/pull/6>a kind contributor</a>, the crate should also work for newer versions like the <a href=https://www.tfa-dostmann.de/en/product/co2-monitor-airco2ntrol-coach-31-5009/>COACH</a>.<h2 id=what-to-do-with-it>What to do with it</h2><p>Open the windows. The CO₂ levels you'll find in a closed room aren't exactly dangerous, but can still cause headaches, malaise and impair thinking skills. At one point I took mine to the office and it showed an error because it only goes up to 3000 ppm. Reading from USB still worked, giving concentrations around 3500 ppm.<p>Having a constant airflow in an office will also help against Covid, possibly even more than wearing masks.<h2 id=demo>Demo</h2><p>My Grafana isn't in the best of shapes these days, but here's a screenshot:<p><a href=/assets/co2.webp target=_blank><img src=/assets/co2.webp></a></div></div>